{{ if .development -}}
{{- $pkgMapping := include "dot_config/packages/package-mapping.toml" | fromToml -}}
# Homebrew package list (for brew bundle)
# Install with: brew bundle --file=~/.config/packages/brewfile
# Generated from package-mapping.toml

# Base and development packages
{{- range $name, $pkg := $pkgMapping }}
{{- if hasKey $pkg "brew" }}
{{- if or (eq $pkg.mode "base") (eq $pkg.mode "development") }}
{{- if eq $.chezmoi.os "darwin" }}
brew "{{ $pkg.brew }}"
{{- else if not (or (hasKey $pkg "apt") (and (hasKey $pkg "darwin_only") $pkg.darwin_only)) }}
brew "{{ $pkg.brew }}"
{{- end }}
{{- end }}
{{- end }}
{{- end }}

# Desktop packages
{{- if $.desktop }}
{{- range $name, $pkg := $pkgMapping }}
{{- if hasKey $pkg "brew" }}
{{- if eq $pkg.mode "desktop" }}
{{- if eq $.chezmoi.os "darwin" }}
brew "{{ $pkg.brew }}"
{{- else if not (or (hasKey $pkg "apt") (and (hasKey $pkg "darwin_only") $pkg.darwin_only)) }}
brew "{{ $pkg.brew }}"
{{- end }}
{{- end }}
{{- end }}
{{- end }}
{{- end }}
{{ end -}}
